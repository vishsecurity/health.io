<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Health Dashboard</title>
<style>
:root {
  --sleep-color:#1e90ff; 
  --cycling-color:#ff9f1a; 
  --water-color:#00bfff;
  --bg-dark:#000; 
  --bg-card:#111; 
  --text-light:#f5f5f5;
  --circle-size:150px;
}
body {
  margin:0;
  font-family:"Segoe UI",Tahoma,Geneva,Verdana,sans-serif;
  background:var(--bg-dark);
  color:var(--text-light);
  display:flex;
  flex-direction:column;
  min-height:100vh;
}
h1 {
  text-align:center;
  padding:20px 0;
  background:#000;
  color:var(--text-light);
  margin:0;
}
.tab {
  display:flex;
  justify-content:center;
  background:#000;
}
.tab button {
  padding:14px 30px;
  cursor:pointer;
  border:none;
  background:none;
  font-size:16px;
  transition:.3s;
  color:var(--text-light);
}
.tab button:hover {background:#222;}
.tab button.active {
  border-bottom:3px solid var(--sleep-color);
  font-weight:bold;
  color:var(--sleep-color);
}
.tabcontent {
  display:none;
  flex:1;
  padding:20px;
}
#Status {
  display:flex;
  flex-direction:column;
  align-items:center;
}
.circle-container {
  display:flex;
  justify-content:center;
  flex-wrap:wrap;
  margin:20px;
}
.circle-card {
  margin:20px;
  text-align:center;
  position:relative;
  background:var(--bg-card);
  padding:20px;
  border-radius:12px;
  box-shadow:0 0 10px rgba(255,255,255,0.1);
}
.circle-card svg {
  width:var(--circle-size);
  height:var(--circle-size);
  transform:rotate(-90deg);
  overflow:visible;
}
.circle-text {
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  font-size:1.4em;
  font-weight:bold;
  color:var(--text-light);
}
.tracker-form {
  max-width:600px;
  margin:20px auto;
  background:var(--bg-card);
  padding:20px;
  border-radius:8px;
  box-shadow:0 2px 6px rgba(255,255,255,0.1);
}
.tracker-form label {
  display:block;
  margin-bottom:5px;
  font-weight:500;
}
.tracker-form input {
  width:100%;
  padding:8px;
  margin-bottom:15px;
  border-radius:4px;
  border:1px solid #333;
  font-size:14px;
  background:#111;
  color:var(--text-light);
}
.tracker-form button {
  background:var(--sleep-color);
  color:white;
  padding:10px 20px;
  border:none;
  border-radius:5px;
  cursor:pointer;
  font-size:16px;
  margin-right:10px;
}
.tracker-form button:hover {opacity:0.85;}
table {
  width:100%;
  border-collapse:collapse;
  margin-top:20px;
  background:var(--bg-card);
}
th,td {
  border:1px solid #333;
  text-align:center;
  padding:10px;
  color:var(--text-light);
}
th {background:#111;}
footer {
  text-align:center;
  padding:15px;
  background:#000;
  color:var(--text-light);
  margin-top:auto;
  font-size:14px;
}
</style>
</head>
<body>

<h1>Health Dashboard</h1>
<div class="tab">
  <button class="tablinks active" onclick="openTab(event,'Status')">Status</button>
  <button class="tablinks" onclick="openTab(event,'Tracker')">Health Tracker</button>
</div>

<div id="Status" class="tabcontent" style="display:flex;">
  <div class="circle-container">
    <div class="circle-card">
      <svg viewBox="0 0 100 100">
        <circle cx="50" cy="50" r="45" stroke="#333" stroke-width="5" fill="none"/>
        <clipPath id="sleepClip"><circle cx="50" cy="50" r="45"/></clipPath>
        <path id="sleepWave" clip-path="url(#sleepClip)" fill="var(--sleep-color)"/>
      </svg>
      <div class="circle-text" id="sleepText">0h</div>
      <div>Sleep</div>
    </div>
    <div class="circle-card">
      <svg viewBox="0 0 100 100">
        <circle cx="50" cy="50" r="45" stroke="#333" stroke-width="5" fill="none"/>
        <clipPath id="cyclingClip"><circle cx="50" cy="50" r="45"/></clipPath>
        <path id="cyclingWave" clip-path="url(#cyclingClip)" fill="var(--cycling-color)"/>
      </svg>
      <div class="circle-text" id="cyclingText">0km</div>
      <div>Cycling</div>
    </div>
    <div class="circle-card">
      <svg viewBox="0 0 100 100">
        <circle cx="50" cy="50" r="45" stroke="#333" stroke-width="5" fill="none"/>
        <clipPath id="waterClip"><circle cx="50" cy="50" r="45"/></clipPath>
        <path id="waterWave" clip-path="url(#waterClip)" fill="var(--water-color)"/>
      </svg>
      <div class="circle-text" id="waterText">0L</div>
      <div>Water</div>
    </div>
  </div>
</div>

<div id="Tracker" class="tabcontent">
<div class="tracker-form">
  <label>Date:</label><input type="date" id="date">
  <label>Sleep (hours):</label><input type="number" id="sleep" min="0" max="12" step="0.1">
  <label>Cycling (km):</label><input type="number" id="cycling" min="0" step="0.1">
  <label>Water (litres):</label><input type="number" id="water" min="0" step="0.1">
  <label>Upload GPX file:</label><input type="file" id="gpxFile" accept=".gpx">
  <div style="margin-top:10px;">
    <button onclick="addEntry()">Add Entry</button>
    <button onclick="exportGPX()">Export GPX</button>
    <button onclick="importGPX()">Import GPX</button>
    <input type="file" id="importGpxInput" accept=".gpx" style="display:none;">
  </div>
</div>

<table id="healthTable">
  <thead><tr><th>Date</th><th>Sleep (hours)</th><th>Cycling (km)</th><th>Water (litres)</th></tr></thead>
  <tbody></tbody>
</table>
</div>

<footer>Â© Vishal Chaudhary. All Rights Reserved.</footer>

<script>
function openTab(evt, tabName){
  document.querySelectorAll(".tabcontent").forEach(tc=>tc.style.display="none");
  document.querySelectorAll(".tablinks").forEach(tb=>tb.classList.remove("active"));
  document.getElementById(tabName).style.display="flex";
  evt.currentTarget.classList.add("active");
}

let healthData=[];
const maxValues={sleep:12,cycling:50,water:5};

function updateWave(id,value,max){
  const percent=Math.min(value/max,1);
  const height=100-(percent*100);
  const wavePath=`M0 ${height} Q25 ${height+3} 50 ${height} T100 ${height} V100 H0 Z`;
  document.getElementById(id).setAttribute("d",wavePath);
}

function setCircleProgress(textId,value){
  document.getElementById(textId).textContent=value+(textId.includes("sleep")?"h":textId.includes("cycling")?"km":"L");
}

function updateStatusCircles(){
  let totalSleep=0,totalCycling=0,totalWater=0;
  healthData.forEach(e=>{totalSleep+=e.sleep; totalCycling+=e.cycling; totalWater+=e.water;});
  setCircleProgress("sleepText",totalSleep.toFixed(1));
  setCircleProgress("cyclingText",totalCycling.toFixed(2));
  setCircleProgress("waterText",totalWater.toFixed(1));
  updateWave("sleepWave",totalSleep,maxValues.sleep);
  updateWave("cyclingWave",totalCycling,maxValues.cycling);
  updateWave("waterWave",totalWater,maxValues.water);
}

function addEntry(){
  const date=document.getElementById('date').value;
  let sleep=parseFloat(document.getElementById('sleep').value);
  let cycling=parseFloat(document.getElementById('cycling').value);
  let water=parseFloat(document.getElementById('water').value);
  if(!date||isNaN(sleep)||isNaN(cycling)||isNaN(water)){ alert("Fill all fields"); return; }
  const gpxFile=document.getElementById("gpxFile").files[0];
  if(gpxFile){
    const reader=new FileReader();
    reader.onload=function(e){
      const parser=new DOMParser();
      const xmlDoc=parser.parseFromString(e.target.result,"text/xml");
      const trkpts=xmlDoc.getElementsByTagNameNS("*","trkpt");
      if(trkpts.length>1){
        let distanceKm=0;
        for(let i=1;i<trkpts.length;i++){
          const lat1=parseFloat(trkpts[i-1].getAttribute("lat"));
          const lon1=parseFloat(trkpts[i-1].getAttribute("lon"));
          const lat2=parseFloat(trkpts[i].getAttribute("lat"));
          const lon2=parseFloat(trkpts[i].getAttribute("lon"));
          if(!isNaN(lat1)&&!isNaN(lon1)&&!isNaN(lat2)&&!isNaN(lon2)){
            distanceKm+=haversine(lat1,lon1,lat2,lon2);
          }
        }
        cycling+=distanceKm;
        alert(`GPX file processed: ${gpxFile.name}\nDistance added: ${distanceKm.toFixed(2)} km`);
      }else{ alert("No valid track points found in GPX file."); }
      saveEntry(date,sleep,cycling,water);
    };
    reader.readAsText(gpxFile);
  }else saveEntry(date,sleep,cycling,water);
}

function saveEntry(date,sleep,cycling,water,skipStorage=false){
  healthData.push({date,sleep,cycling,water});
  const table=document.querySelector('#healthTable tbody');
  const newRow=table.insertRow();
  newRow.insertCell(0).textContent=date;
  newRow.insertCell(1).textContent=sleep;
  newRow.insertCell(2).textContent=cycling.toFixed(2);
  newRow.insertCell(3).textContent=water;
  updateStatusCircles();
  if(!skipStorage) localStorage.setItem('healthData', JSON.stringify(healthData));
  document.getElementById('date').value='';
  document.getElementById('sleep').value='';
  document.getElementById('cycling').value='';
  document.getElementById('water').value='';
  document.getElementById('gpxFile').value='';
}

function haversine(lat1,lon1,lat2,lon2){
  const R=6371;
  const toRad=x=>x*Math.PI/180;
  const dLat=toRad(lat2-lat1);
  const dLon=toRad(lon2-lon1);
  const a=Math.sin(dLat/2)**2 + Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;
  const c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
  return R*c;
}

// GPX Export
function exportGPX(){
  if(healthData.length===0){alert("No data to export!");return;}
  let gpx=`<?xml version="1.0" encoding="UTF-8"?>\n<gpx version="1.1" creator="HealthDashboard" xmlns="http://www.topografix.com/GPX/1/1">\n`;
  healthData.forEach(entry=>{
    gpx+=`  <trk>\n    <name>${entry.date}</name>\n    <desc>Sleep: ${entry.sleep}h, Cycling: ${entry.cycling}km, Water: ${entry.water}L</desc>\n    <trkseg>\n      <trkpt lat="0" lon="0"><ele>0</ele><time>${entry.date}T00:00:00Z</time></trkpt>\n    </trkseg>\n  </trk>\n`;
  });
  gpx+=`</gpx>`;
  const blob=new Blob([gpx],{type:"application/gpx+xml"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="health_data_export.gpx";
  a.click();
}

// GPX Import
function importGPX(){
  document.getElementById('importGpxInput').click();
}
document.getElementById('importGpxInput').addEventListener('change', function(){
  const file=this.files[0];
  if(file){
    const reader=new FileReader();
    reader.onload=function(e){
      const parser=new DOMParser();
      const xmlDoc=parser.parseFromString(e.target.result,"text/xml");
      const trks=xmlDoc.getElementsByTagNameNS("*","trk");
      for(let i=0;i<trks.length;i++){
        const name=trks[i].getElementsByTagNameNS("*","name")[0]?.textContent || "Unknown";
        const desc=trks[i].getElementsByTagNameNS("*","desc")[0]?.textContent || "";
        const sleep=parseFloat(desc.match(/Sleep: ([0-9.]+)/)?.[1]||0);
        const cycling=parseFloat(desc.match(/Cycling: ([0-9.]+)/)?.[1]||0);
        const water=parseFloat(desc.match(/Water: ([0-9.]+)/)?.[1]||0);
        saveEntry(name,sleep,cycling,water,true);
      }
    };
    reader.readAsText(file);
  }
});
</script>
</body>
</html>
